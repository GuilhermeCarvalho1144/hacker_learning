import os
from cryptography.fernet import Fernet

def read_key(key_path):
    with open(key_path, 'rb') as rkey:
        key = rkey.read()
    return key
    
def decryption_files(files, key):
    for file in files:
        with open(file, 'rb') as rfile:
            contents = rfile.read()
        content_decrypted = Fernet(key).decrypt(contents)
        with open(file,'wb') as wfile:
            wfile.write(content_decrypted)

if __name__ == '__main__':
    key_path = './key.key'
    key = read_key(key_path)
    target_folder = './test_folder'
    files = [os.path.join(target_folder, f) for f in os.listdir(target_folder)]
    decryption_files(files, key)
    print("DONE!")
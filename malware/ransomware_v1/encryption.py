import os
from cryptography.fernet import Fernet

def gen_secury_key(save_key):
    key = Fernet.generate_key()
    if save_key:
        with open("key.key", 'wb') as fkey:
            fkey.write(key)
    return key

def encryption_files(files, key):
    for file in files:
        with open(file, 'rb') as rfile:
            contents = rfile.read()
        content_encrypted = Fernet(key).encrypt(contents)
        with open(file,'wb') as wfile:
            wfile.write(content_encrypted)

if __name__ == '__main__':
    key = gen_secury_key(True)
    target_folder = './test_folder'
    files = [os.path.join(target_folder, f) for f in os.listdir(target_folder)]
    encryption_files(files, key)
    print("DONE!")